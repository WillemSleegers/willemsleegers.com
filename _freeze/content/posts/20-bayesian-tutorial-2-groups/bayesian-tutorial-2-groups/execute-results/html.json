{
  "hash": "1c1248a602a996bb8988b6deeb66e1d4",
  "result": {
    "markdown": "---\ntitle: \"Bayesian tutorial: Two groups\"\ndescription: \"The fourth of a series of tutorial posts on Bayesian analyses. In this post I focus on using `brms` to model the difference between two groups.\"\ndate: 2022-11-24\ncategories:\n  - statistics\n  - tutorial\n  - Bayesian statistics\n  - regression\ncode-fold: true\ncode-tools: true\ntoc: true\ndraft: true\n---\n\n\nIn this blog post I will cover how to use `brms` to analyze the difference between two groups. Interestingly, this might seem like a very simple analysis, but there are actually many ways to go about this. I'll try to cover each one here. \n\nThe data we'll use is the same as in the previous posts. This data contains the sex of the participant in a column called `male`, in addition to their height, weight, and age. This means we can investigate, say, whether there's a difference in height between men and women.\n\nRun the following setup code if you want to follow along.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(tidybayes)\n\ndata <- read_csv(\"Howell1.csv\")\ndata <- filter(data, age >= 18)\n\ntheme_set(theme_minimal())\n\ncolors <- c(\"#93CFDB\", \"#1E466E\")\n```\n:::\n\n\n## Dummy coding\n\nProbably the most common method to analyze the difference between two groups is to regress the outcome on dummy coded data. The R formula for this is `height ~ male`. Let's see what priors we need to set for this.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(height ~ male, data = data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    prior     class coef group resp dpar nlpar lb ub\n                   (flat)         b                                 \n                   (flat)         b male                            \n student_t(3, 154.3, 8.5) Intercept                                 \n     student_t(3, 0, 8.5)     sigma                             0   \n       source\n      default\n (vectorized)\n      default\n      default\n```\n:::\n:::\n\n\nThe output shows we need to set a prior on sigma, the Intercept, and on the male coefficient. The sigma parameter is the same as before, but the intercept and male coefficient are different. The intercept now refers to the heights of female participants and the male coefficient refers to the difference between males and females. \n\nWriting down this model shows that it's actually the same as the simple regression model:\n\n$$\\displaylines{heights_i âˆ¼ Normal(\\mu_i, \\sigma) \\\\ \\mu_i = \\alpha + \\beta x_i}$$\n\nDespite this similarity, there's an issue here that we need to get into. Let's demonstrate this issue by setting some priors visualizing them.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_gender_dummy <- brm(\n  height ~ 1 + male,  \n  data = data, \n  family = gaussian,\n  prior = c(\n    prior(normal(160, 10), class = \"Intercept\"),\n    prior(normal(5, 10), coef = \"male\"),\n    prior(cauchy(5, 5), class = \"sigma\")\n  ),\n  sample_prior = TRUE,\n  cores = 4\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCompiling Stan program...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nStart sampling\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- mutate(data, female = 1 - male)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(height ~ 0 + male + female, data = data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                prior class   coef group resp dpar nlpar lb ub       source\n               (flat)     b                                         default\n               (flat)     b female                             (vectorized)\n               (flat)     b   male                             (vectorized)\n student_t(3, 0, 8.5) sigma                               0         default\n```\n:::\n:::\n\n\nWhat should the prior for $\\sigma$ be? With the variables standardized, $\\sigma$ is limited to range from 0 to 1. If the predictor explains all the variance of the outcome variable, the residuals will be 0, meaning $\\sigma$ will be 0. If the predictor explains no variance, $\\sigma$ is equal to 1 because it will be similar to the standard deviation of the outcome variable, which is 1 because we've standardized it. Interestingly, this also means that the prior for $\\sigma$ is now dependent on the prior for the slope, because the slope is what determines how much variance is explained in the outcome variable. So let's think about the prior for the slope.\n\nThe prior for the slope is a bit easier now. We can specify a normal distribution with a mean of 0 and a standard deviation of 0.5, together with a lower bound of -1 and upper bound of 1. With a standard deviation of 0.5, we cover a large range of possible slopes, but assign more plausibility to smaller correlations and less plausibility to very high correlations (like 1 and -1).\n\nAs for $\\sigma$, let's keep it simple and use a uniform prior that assign equal plausibility to each value between 0 and 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_height_male <- brm(\n  height ~ 0 + male + female,  \n  data = data, \n  family = gaussian,\n  prior = c(\n    prior(normal(170, 10), coef = \"female\"),\n    prior(normal(170, 10), coef = \"male\"),\n    prior(cauchy(5, 5), class = \"sigma\")\n  ),\n  sample_prior = TRUE,\n  cores = 4,\n  seed = 4,\n  file = \"models/model_height.rds\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCompiling Stan program...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nStart sampling\n```\n:::\n\n```{.r .cell-code}\nmodel_height_male\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: height ~ 0 + male + female \n   Data: data (Number of observations: 352) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nPopulation-Level Effects: \n       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nmale     160.38      0.43   159.55   161.23 1.00     4396     3063\nfemale   149.55      0.43   148.69   150.38 1.00     4976     2900\n\nFamily Specific Parameters: \n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     5.56      0.21     5.16     5.99 1.00     4492     3180\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n\n```{.r .cell-code}\ndraws <- spread_draws(model_height_male, b_male, b_female)\ndraws <- mutate(draws, diff = b_male - b_female)\n```\n:::\n",
    "supporting": [
      "bayesian-tutorial-2-groups_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}